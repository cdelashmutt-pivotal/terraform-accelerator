accelerator:
  displayName: Azure AKS with Tanzu Application Platform
  description: Terraform scripts and kapp-controller resources to bootstrap TAP for an organizational unit
  iconUrl: https://tanzu.vmware.com/developer/images/icons/icon-tap.svg
  tags:
  - infrastructure
  - tanzu
  - azure
  - aks

  options:
  - name: businessUnit
    label: Business Unit
    inputType: select
    choices:
    - value: gbs
      text: GBS
    - value: account-processing
      text: Account Processing
    - value: risk-management
      text: Risk Management
    - value: fts
      text: FTS
    defaultValue: gbs
    required: true

  - name: devEnvironment
    label: Development
    inputType: checkbox
    dataType: boolean

  - name: devTapProfile
    label: Development Cluster TAP Profile
    inputType: select
    dependsOn:
      name: devEnvironment
      value: true
    choices:
    - value: iterate
      text: iterate
    - value: full
      text: Full
    defaultValue: iterate

  - name: devNetwork
    label: Network for Development Cluster TAP Profile
    inputType: select
    dependsOn:
      name: devEnvironment
      value: true
    choices:
    - value: net1
      text: network1
    - value: net2
      text: network2
    defaultValue: net1

  - name: qaEnvironment
    label: QA
    inputType: checkbox
    dataType: boolean

  - name: qaNetwork
    label: Network for QA Cluster TAP Profile
    inputType: select
    dependsOn:
      name: qaEnvironment
      value: true
    choices:
    - value: net1
      text: network1
    - value: net2
      text: network2
    defaultValue: net1

  - name: prodEnvironment
    label: Production
    inputType: checkbox
    dataType: boolean

  - name: prodNetwork
    label: Network for Staging and Prod Cluster TAP Profile
    inputType: select
    dependsOn:
      name: prodEnvironment
      value: true
    choices:
    - value: net1
      text: network1
    - value: net2
      text: network2
    defaultValue: net1

  - name: centralClusterIngress
    label: Central Cluster Ingress Domain
    inputType: text
    dataType: string
    defaultValue: central.azure.grogscave.net

engine:
  merge:
  - include: [".gitignore"]
 
  - include: ["README.md"]
    merge:
    - type: ReplaceText
      substitutions:
        - text: "NAMESPACE"
          with: "#businessUnit"

  - include: ["cluster/**/*"]
    merge:
    - type: ReplaceText
      substitutions:
        - text: "INGRESS-DOMAIN"
          with: "#businessUnit + '.azure.grogscave.net'"
        - text: "REGISTRY-SERVER"
          with: "#businessUnit + 'cdelashmuttvmware'"
        - text: "VIEW-CLUSTER-INGRESS-DOMAIN"
          with: "#centralClusterIngress"

  - include: ["**/*.tf"]
    merge:
    - type: ReplaceText
      substitutions:
      - text: "EXAMPLE_PROJECT_NAME"
        with: "#businessUnit"
      - text: "TAP_PROFILE"
        with: "#devTapProfile"